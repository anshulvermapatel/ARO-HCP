
identity:
  userAssignedIdentities:
    "/subscriptions/1d3378d3-5a3f-4712-85a1-2485495dfc4b/resourcegroups/aro-hcp-dev-image-sync/providers/Microsoft.ManagedIdentity/userAssignedIdentities/image-sync-sxo4oqbcjiekg": {}
  type: UserAssigned
properties:
  environmentId: "/subscriptions/1d3378d3-5a3f-4712-85a1-2485495dfc4b/resourceGroups/aro-hcp-dev-image-sync/providers/Microsoft.App/managedEnvironments/image-sync-env-sxo4oqbcjiekg"
  configuration:
    replicaTimeout: 10
    replicaRetryLimit: 10
    manualTriggerConfig:
      replicaCompletionCount: 1
      parallelism: 4
    triggerType: Manual
    registries:
      - identity: "/subscriptions/1d3378d3-5a3f-4712-85a1-2485495dfc4b/resourcegroups/aro-hcp-dev-image-sync/providers/Microsoft.ManagedIdentity/userAssignedIdentities/image-sync-sxo4oqbcjiekg"
        server: arohcpdev.azurecr.io
  template:
    containers:
    - image: arohcpdev.azurecr.io/image-sync/component-sync:latest
      name: sync-components
    #   volumeMounts:
    #   - volumeName: pull-secrets-updated
    #     mountPath: "/etc/containers"
    # initContainers:
    # - image: mcr.microsoft.com/azure-cli:cbl-mariner2.0
    #   name: login
    #   command: ['sh', '-c',
    #       "az login --federated-token $(cat $AZURE_FEDERATED_TOKEN_FILE) --service-principal -u $AZURE_CLIENT_ID -t $AZURE_TENANT_ID; accessToken=$(az acr login --name {{ .Values.acrRegistryName }} --expose-token | grep accessToken |cut -d ':' -f2| tr -d ' \",') ; cat /tmp/secret-orig/pull-secret | base64 -d  |sed \"s/TOKENTOBEREPLACED/$accessToken/\" > /etc/containers/auth.json",
    #     ]
    #   volumeMounts:
    #   - volumeName: pull-secrets-updated
    #     mountPath: "/etc/containers"
    # volumes:
    # - name: pull-secrets-updated
    #   storageType: EmptyDir
